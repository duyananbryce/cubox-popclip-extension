# Cubox Saver 更新日志 - v5.1

## v5.1 (2024) - API 兼容性修复版本 🔧

### 🚨 紧急修复
- **修复 API URL 验证错误**：解决 "Invalid Cubox API URL" 错误
- **支持双域名**：同时支持 `cubox.pro` 和 `cubox.cc` 域名
- **兼容新旧版本**：适配 Cubox 官网的域名变更

### 🔧 技术改进
- **URL 验证逻辑优化**：从单一域名检查改为双域名支持
- **错误提示保持不变**：用户体验一致性
- **向后兼容**：支持使用旧域名的用户

### 📋 修复详情

#### 问题描述
v5.0 版本的 URL 验证只检查 `cubox.cc` 域名：
```javascript
// v5.0 - 只支持 cubox.cc
if (url.indexOf('cubox.cc') === -1) {
    popclip.showText('⚠️ Invalid Cubox API URL');
    return;
}
```

#### 解决方案
v5.1 版本支持两个域名：
```javascript
// v5.1 - 支持 cubox.pro 和 cubox.cc
if (url.indexOf('cubox.pro') === -1 && url.indexOf('cubox.cc') === -1) {
    popclip.showText('⚠️ Invalid Cubox API URL');
    return;
}
```

### ✅ 支持的 API URL 格式

**新版本 Cubox (推荐)**：
```
https://cubox.pro/c/api/save_url?token=YOUR_TOKEN
```

**旧版本 Cubox**：
```
https://cubox.cc/c/api/save_url?token=YOUR_TOKEN
```

### 🔄 升级指南

#### 从 v5.0 升级到 v5.1
1. **无需重新配置**：如果你使用的是 `cubox.cc` 域名，插件会继续正常工作
2. **支持新域名**：如果你使用的是 `cubox.pro` 域名，现在可以正常使用了
3. **版本验证**：安装后确认版本显示为 "Cubox Saver v5.1"

#### 配置验证
确保你的 API URL 符合以下格式之一：
- ✅ `https://cubox.pro/c/api/save_url?token=...`
- ✅ `https://cubox.cc/c/api/save_url?token=...`

### 🧪 测试验证

安装 v5.1 后，请进行以下测试：
1. **选择文本**：在任意应用中选择一段文本
2. **执行保存**：点击 PopClip 中的 "Save to Cubox"
3. **验证结果**：应该显示 "✅ Saved to Cubox!" 而不是 "Invalid Cubox API URL"

### 📊 版本对比

| 特性 | v5.0 | v5.1 |
|------|------|------|
| cubox.cc 支持 | ✅ | ✅ |
| cubox.pro 支持 | ❌ | ✅ |
| API 验证逻辑 | 单域名 | 双域名 |
| 向后兼容性 | 部分 | 完全 |
| 错误提示 | 一致 | 一致 |

### 🔍 故障排除

如果仍然遇到问题，请检查：
1. **API URL 格式**：确保包含正确的路径 `/c/api/save_url`
2. **Token 参数**：确保 URL 包含 `?token=` 参数
3. **网络连接**：测试是否能访问 Cubox 网站
4. **插件版本**：确认安装的是 v5.1 版本

参考：[故障排除 - API 配置错误.md](./故障排除%20-%20API%20配置错误.md)

---

## 历史版本

### v5.0 (2024) - 官方标准版本
- 基于 PopClip 官方文档完全重写
- 采用标准顶层执行模式
- 使用标准 PopClip API
- 彻底解决 "Can't find variable" 错误

### v4.x 系列（已废弃）
- v4.4：修复函数变量冲突
- v4.3：添加函数定义
- v4.2：四重兼容性尝试
- v4.1：双重兼容设计

---

**推荐立即升级到 v5.1 版本，这是目前最稳定和兼容性最好的版本。**