# Cubox Saver v5.4 更新日志

## 🔧 修复内容

### 核心问题
用户报告错误：`"Using XMLHttpRequest requires the 'network' entitlement"`

### 根本原因
PopClip 扩展需要明确声明网络权限才能使用 XMLHttpRequest 进行网络请求。

### 解决方案
在 `Config.json` 中添加网络权限配置：
```json
"entitlements": ["network"]
```

## 📋 技术细节

### v5.3 vs v5.4 对比

**v5.3 Config.json**：
```json
{
  "name": "Cubox Saver v5.3",
  "identifier": "cc.cubox.popclip.saver.v5.3",
  "popclipVersion": 4155,
  // 缺少网络权限
}
```

**v5.4 Config.json**：
```json
{
  "name": "Cubox Saver v5.4",
  "identifier": "cc.cubox.popclip.saver.v5.4",
  "popclipVersion": 4155,
  "entitlements": ["network"], // ✅ 添加网络权限
}
```

### 权限说明
- `"network"` 权限允许扩展进行网络请求
- 这是 PopClip 安全模型的一部分
- 没有此权限，XMLHttpRequest 会被阻止

## 🚀 功能特性

### 保持的功能
- ✅ 支持新 API 格式：`/c/api/save/TOKEN`
- ✅ 支持旧 API 格式：`/c/api/save_url?token=TOKEN`
- ✅ 兼容 `cubox.pro` 和 `cubox.cc` 域名
- ✅ 异步 XMLHttpRequest（v5.3 修复）
- ✅ 完善的错误处理

### 新增功能
- ✅ **网络权限配置** - 解决权限错误
- ✅ **PopClip 兼容性** - 符合安全要求

## 📦 升级步骤

### 从 v5.3 升级到 v5.4
1. **删除旧版本**：
   - 打开 PopClip 设置
   - 找到 "Cubox Saver v5.3"
   - 点击删除

2. **安装新版本**：
   - 双击 `Cubox Saver.popclipext`
   - PopClip 会自动安装 v5.4

3. **保持配置**：
   - API URL 设置会保留
   - 文件夹和标签设置会保留

4. **测试功能**：
   - 选择文本
   - 点击 "Save to Cubox"
   - 应该显示 "✅ Saved to Cubox!"

## 🔍 错误解决对照表

| 错误信息 | 版本 | 状态 |
|---------|------|------|
| `Using XMLHttpRequest requires the 'network' entitlement` | v5.3 | ❌ 未修复 |
| `Using XMLHttpRequest requires the 'network' entitlement` | v5.4 | ✅ 已修复 |
| `Network error` (同步请求) | v5.2 | ❌ 未修复 |
| `Network error` (同步请求) | v5.3+ | ✅ 已修复 |
| `Invalid Cubox API URL` | v5.0 | ❌ 未修复 |
| `Invalid Cubox API URL` | v5.1+ | ✅ 已修复 |

## 🎯 版本历史

| 版本 | 主要修复 | 发布原因 |
|------|----------|----------|
| v5.4 | 添加网络权限 | 解决 PopClip 权限错误 |
| v5.3 | 异步请求 | 解决同步请求限制 |
| v5.2 | 新 API 格式 | 支持 Cubox 新接口 |
| v5.1 | URL 验证 | 修复 API URL 格式问题 |
| v5.0 | PopClip 标准 | 符合 PopClip 规范 |

## 🛠️ 故障排除

### 如果仍有问题
1. **确认版本**：PopClip 中显示 "Cubox Saver v5.4"
2. **检查权限**：重新安装确保权限生效
3. **测试网络**：确认网络连接正常
4. **验证 API**：确认 Cubox API URL 正确

### 常见问题
- **Q**: 升级后设置丢失？
- **A**: 正常情况下设置会保留，如丢失请重新配置

- **Q**: 仍显示权限错误？
- **A**: 确保完全删除旧版本后再安装新版本

---

**技术支持**：如遇问题，请提供具体错误信息和 PopClip 版本号。