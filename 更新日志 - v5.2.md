# Cubox Saver v5.2 更新日志

## 🚀 版本信息
- **版本号**: v5.2
- **发布日期**: 2025-01-28
- **更新类型**: API 兼容性增强

## 🔧 主要更新

### 新增功能
- ✅ **支持新版 Cubox API 格式**
  - 兼容新格式：`https://cubox.pro/c/api/save/TOKEN`
  - 保持旧格式支持：`https://cubox.pro/c/api/save_url?token=TOKEN`
  - 自动识别 API 格式类型

### 技术改进
- 🔍 **增强 URL 验证逻辑**
  - 检测 `/c/api/save_url` (旧格式)
  - 检测 `/c/api/save/` (新格式)
  - 提供更精确的错误提示

## 📋 修复详情

### 问题描述
用户报告 "Network error" 错误，经分析发现是因为 Cubox 更新了 API 格式：
- **旧格式**: `https://cubox.pro/c/api/save_url?token=YOUR_TOKEN`
- **新格式**: `https://cubox.pro/c/api/save/YOUR_TOKEN`

### 解决方案
```javascript
// v5.1 代码（仅支持旧格式）
if (url.indexOf('cubox.pro') === -1 && url.indexOf('cubox.cc') === -1) {
    popclip.showText('⚠️ Invalid Cubox API URL');
    return;
}

// v5.2 代码（支持新旧格式）
if (url.indexOf('cubox.pro') === -1 && url.indexOf('cubox.cc') === -1) {
    popclip.showText('⚠️ Invalid Cubox API URL');
    return;
}

// 验证 API 路径格式
var isOldFormat = url.indexOf('/c/api/save_url') !== -1;
var isNewFormat = url.indexOf('/c/api/save/') !== -1;
if (!isOldFormat && !isNewFormat) {
    popclip.showText('⚠️ Invalid API URL format');
    return;
}
```

## 🎯 支持的 API URL 格式

### ✅ 新格式（推荐）
```
https://cubox.pro/c/api/save/ajqVdgm7qMO
https://cubox.cc/c/api/save/xyz789abc
```

### ✅ 旧格式（兼容）
```
https://cubox.pro/c/api/save_url?token=ajqVdgm7qMO
https://cubox.cc/c/api/save_url?token=xyz789abc
```

### ❌ 不支持的格式
```
https://cubox.pro/api/save/token     # 缺少 /c/ 路径
https://cubox.pro/c/save/token       # 缺少 /api/ 路径
https://other-domain.com/api/save    # 域名不匹配
```

## 🔄 从 v5.1 升级到 v5.2

### 升级步骤
1. **备份当前配置**（可选）
2. **删除旧版本**：在 PopClip 中移除 Cubox Saver v5.1
3. **安装新版本**：双击 `Cubox Saver.popclipext` 安装 v5.2
4. **重新配置**：输入您的 Cubox API URL（新旧格式均可）
5. **测试功能**：选择文本并测试保存功能

### 配置验证
```bash
# 测试新格式 API
curl -v "https://cubox.pro/c/api/save/YOUR_TOKEN" \
  -X POST \
  -H "Content-Type: application/json" \
  -d '{"type":"memo","content":"test v5.2"}'
```

## 📊 版本对比

| 功能 | v5.0 | v5.1 | v5.2 |
|------|------|------|------|
| cubox.cc 支持 | ❌ | ✅ | ✅ |
| cubox.pro 支持 | ✅ | ✅ | ✅ |
| 旧 API 格式 | ✅ | ✅ | ✅ |
| 新 API 格式 | ❌ | ❌ | ✅ |
| URL 格式验证 | 基础 | 增强 | 完整 |

## 🐛 故障排除

### 如果仍然出现 "Network error"
1. **检查 API URL 格式**：确保使用正确的新格式
2. **验证网络连接**：测试 `curl -I https://cubox.pro`
3. **重新获取 API**：从 Cubox 设置中重新复制 API URL
4. **清除缓存**：重新安装插件

### 常见错误信息
- `⚠️ Invalid Cubox API URL` - 域名不正确
- `⚠️ Invalid API URL format` - API 路径格式不正确
- `❌ Network error` - 网络连接问题

## 📚 相关文档
- [安装和使用指南](./安装和使用指南.md)
- [故障排除 - API 配置错误](./故障排除%20-%20API%20配置错误.md)
- [Cubox 官方 API 文档](https://help.cubox.pro/save/89d3/)

---

**注意**: v5.2 完全向后兼容，现有的旧格式 API URL 无需更改即可继续使用。